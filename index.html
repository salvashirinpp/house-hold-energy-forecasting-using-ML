<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Next-Day Energy Forecast</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0f172a; color: #e2e8f0; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 40px auto; background: #1e293b; padding: 40px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h1 { text-align: center; color: #60a5fa; }
        .section { margin: 30px 0; padding: 20px; background: #334155; border-radius: 12px; }
        label { display: block; margin: 15px 0 8px; font-weight: bold; color: #94a3b8; }
        input[type=number], input[type=date] { width: 100%; padding: 12px; border-radius: 8px; border: none; background: #475569; color: white; font-size: 16px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; }
        button { width: 100%; padding: 16px; background: #3b82f6; color: white; border: none; border-radius: 12px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 20px; }
        button:hover { background: #2563eb; }
        .result { margin-top: 30px; padding: 25px; background: #1e40af; border-radius: 12px; text-align: center; font-size: 28px; display: none; }
        .advanced-toggle { color: #60a5fa; cursor: pointer; text-decoration: underline; margin-top: 10px; }
        .note { font-size: 14px; color: #94a3b8; margin-top: 20px; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ”‹ Next-Day Household Energy Forecast</h1>
        <p style="text-align:center; color:#94a3b8;">Powered by {{ model_type }} â€¢ Trained on real home sensor data</p>

        <div class="section">
            <label>Prediction Date (Tomorrow)</label>
            <input type="date" id="predictDate" value="{{ tomorrow }}" readonly>
        </div>

        <div class="section">
            <label>Last 7 Days Appliance Energy Use (Wh) â€” Most Recent First</label>
            <div class="grid">
                <input type="number" placeholder="Today" id="d1" required>
                <input type="number" placeholder="Yesterday" id="d2" required>
                <input type="number" placeholder="2 days ago" id="d3" required>
                <input type="number" placeholder="3 days ago" id="d4" required>
                <input type="number" placeholder="4 days ago" id="d5" required>
                <input type="number" placeholder="5 days ago" id="d6" required>
                <input type="number" placeholder="6 days ago" id="d7" required>
            </div>
        </div>

        <div class="section">
            <label>Lights Energy Today (Wh) â€” Most Important Feature!</label>
            <input type="number" id="lights" placeholder="e.g. 200 (or estimate)" required>
        </div>

        <div class="section">
            <div class="advanced-toggle" onclick="document.getElementById('advanced').style.display='block'; this.style.display='none';">
                + Add advanced inputs (improves accuracy)
            </div>
            <div id="advanced" style="display:none;">
                <label>Bedroom Temperature (Â°C)</label>
                <input type="number" step="0.1" id="bedroom_temp" placeholder="e.g. 21.5">

                <label>Windspeed (km/h)</label>
                <input type="number" step="0.1" id="windspeed" placeholder="from weather app">

                <label>Atmospheric Pressure (mm Hg)</label>
                <input type="number" id="pressure" placeholder="e.g. 760">
            </div>
        </div>

        <button onclick="predict()">Predict Tomorrow's Energy Use</button>

        <div id="result" class="result"></div>

        <p class="note">
            Based on your past week + lights usage. Advanced fields (bedroom temp, wind, pressure) boost accuracy!
        </p>
    </div>

    <script>
        function predict() {
            const days = [];
            for (let i = 1; i <= 7; i++) {
                const val = parseFloat(document.getElementById(`d${i}`).value);
                if (isNaN(val) || val < 0) return alert("Please enter valid energy values");
                days.push(val);
            }
            days.reverse(); // Make most recent first

            const data = {
                recent_7_days: days,
                lights: parseFloat(document.getElementById('lights').value) || 0,
                predict_date: document.getElementById('predictDate').value,
                bedroom_temp: parseFloat(document.getElementById('bedroom_temp').value) || null,
                windspeed: parseFloat(document.getElementById('windspeed').value) || null,
                pressure: parseFloat(document.getElementById('pressure').value) || null
            };

            fetch('/predict', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            })
            .then(r => r.json())
            .then(res => {
                const result = document.getElementById('result');
                if (res.success) {
                    result.innerHTML = `
                        <strong>Predicted Energy on ${res.date}:</strong><br>
                        <span style="font-size:48px; color:#60a5fa;">${res.prediction_wh} Wh</span><br><br>
                        <small>Model: ${res.model}</small>
                    `;
                } else {
                    result.innerHTML = `<strong>Error:</strong> ${res.error}`;
                }
                result.style.display = 'block';
            });
        }
    </script>
</body>
</html>